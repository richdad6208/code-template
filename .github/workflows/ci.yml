name: Build & Deploy Docker

on:
    push:
        branches: [main, dev]

jobs:
    build:
        runs-on: self-hosted

        steps:
            - name: ğŸ“¦ Checkout repository
              uses: actions/checkout@v3

            - name: ğŸ— Build Docker image
              run: docker build -t image-template:latest .

            - name: ğŸ§¼ Stop existing container
              run: |
                  docker stop container-template || true
                  docker rm container-template || true

            - name: ğŸš€ Run new container
              run: docker run -d -p 3000:3000 --name container-template image-template:latest

            - name: ğŸ§¹ Clean up unused Docker data
              run: docker system prune -af --volumes
